{% extends "base.html" %}

{% block content %}


    <section id="Merger" class="flex flex-col md:flex-row gap-3 mx-2 xl:mx-0 my-2">
        <section id="RecentlyAdded" class="my-2 md:my-5 flex flex-col md:w-5/6">
            <div class="w-full bg-[#830506] flex items-center justify-center px-4 py-1 md:py-3 text-center">
                <i class="fa-solid fa-bolt" style="vertical-align: middle; font-size: large;"></i>
                <h2 class="font-bold text-white text-[100%] md:text-[130%]">Results for {{query}}</h2>
            </div>
            

            <!-- Telegram CTA box -->
            <div id="telegramCta" class="mt-4">
                <div class="flex items-center justify-between p-4 rounded-lg shadow-md" style="background-color:#0088cc;">
                    <div class="flex items-center gap-3">
                        <i class="fa-brands fa-telegram-plane text-white text-2xl" aria-hidden="true"></i>
                        <div>
                            <p class="text-white font-semibold">Join our Telegram group</p>
                            <p class="text-white text-sm opacity-90">Get updates, trailers and new releases</p>
                        </div>
                    </div>
                        <a href="#" id="telegramJoinBtn" class="inline-block bg-white text-[#0088cc] font-semibold px-4 py-2 rounded-md hover:opacity-95">JOIN OUR TELEGRAM GROUP</a>
                </div>
            </div>
            {% if videos.items %}
                <div id="RecentlyAddedbox" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 py-2 md:py-4">
                
                    {% for video in videos.items %}
                        {% if video.type == 'movie' %}
                            <div class="relative flex flex-col boxescard recentBox rounded-md overflow-hidden"
                        onclick="window.location.href='{{url_for("main.detail", det=video.type, name=video.name, id=video.id)}}'">
                            <div class="absolute z-40 bg-black flex left-0 text-[8px] lg:text-[12px] p-1 justify-center items-center">
                                {% set rating = video.rating | float %}
                                <div class="stars-container">
                                    {% for i in range(1, 6) %}
                                        {% set fraction = rating - (i - 1) %}
                                        {% if fraction >= 1 %}
                                        <span class="moviestar full"><i class="fas fa-star" aria-hidden="true"></i></span>
                                        {% elif fraction > 0 %}
                                        <span class="moviestar partial">
                                            <i class="fas fa-star base" aria-hidden="true"></i>
                                            <span class="fill-wrap" style="width: {{ (fraction * 100)|round(2) }}%;">
                                            <i class="fas fa-star fill" aria-hidden="true"></i>
                                            </span>
                                        </span>
                                        {% else %}
                                        <span class="moviestar"><i class="fas fa-star" aria-hidden="true"></i></span>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <p class="text-white ml-1">{{ video.rating | round(1) }}</p>
                            </div>
                            <!-- Image wrapper -->
                            <div class="w-full aspect-[2/3] relative">
                                <img 
                                src="{{ video.image }}"
                                alt="{{ video.name }}"
                                class="absolute inset-0 w-full h-full object-cover"
                                >
                            </div>

                            <div class="flex flex-col justify-between flex-grow">
                                <!-- Info -->
                                <div id="recentBoxinfo" class="flex justify-between px-2 py-1 text-[#830506] text-sm">
                                    <div class="flex items-center space-x-1">
                                        <i class="fas fa-calendar-alt"></i>
                                        <p class="truncate">{{ video.date_added.strftime('%b %d, %Y') if video.date_added else "Unknown" }}</p>
                                    </div>
                                    <div class="flex items-center space-x-1">
                                        <i class="fas fa-comment"></i>
                                        <p>{{ video.total_comment }}</p>
                                    </div>
                                    
                                </div>

                                <!-- Title -->
                                <div id="recentBoxtitle" class="text-black text-left p-2.5 font-semibold text-sm md:text-base">
                                <h3 class="line-clamp-2 leading-snug">{{ video.name }}</h3>
                                </div>

                                <div id="recentBoxtype" class="w-fit rounded-md mx-auto mb-2 text-black text-center p-1 font-semibold text-sm md:text-base">
                                <h3>{{ video.type | title }}</h3>
                                </div>
                            </div>

                        </div>
                        {% elif video.type == 'series' %}
                            <div class="relative flex flex-col boxescard recentBox rounded-md overflow-hidden"
                        onclick="window.location.href='{{url_for("main.detail", det=video.type, name=video.name, id=video.id)}}'">
                            <div class="absolute z-40 bg-black flex left-0 text-[8px] lg:text-[12px] p-1 justify-center items-center">
                                {% set rating = video.rating | float %}
                                <div class="stars-container">
                                    {% for i in range(1, 6) %}
                                        {% set fraction = rating - (i - 1) %}
                                        {% if fraction >= 1 %}
                                        <span class="moviestar full"><i class="fas fa-star" aria-hidden="true"></i></span>
                                        {% elif fraction > 0 %}
                                        <span class="moviestar partial">
                                            <i class="fas fa-star base" aria-hidden="true"></i>
                                            <span class="fill-wrap" style="width: {{ (fraction * 100)|round(2) }}%;">
                                            <i class="fas fa-star fill" aria-hidden="true"></i>
                                            </span>
                                        </span>
                                        {% else %}
                                        <span class="moviestar"><i class="fas fa-star" aria-hidden="true"></i></span>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <p class="text-white ml-1">{{ video.rating | round(1) }}</p>
                            </div>
                            <!-- Image wrapper -->
                            <div class="w-full aspect-[2/3] relative">
                                <img 
                                src="{{ video.image }}"
                                alt="{{ video.name }}"
                                class="absolute inset-0 w-full h-full object-cover"
                                >
                            </div>

                            <div class="flex flex-col justify-between flex-grow">
                                <!-- Info -->
                                <div id="recentBoxinfo" class="flex justify-between px-2 py-1 text-[#830506] text-sm">
                                    <div class="flex items-center space-x-1">
                                        <i class="fas fa-calendar-alt"></i>
                                        <p class="truncate">{{ video.date_added.strftime('%b %d, %Y') if video.date_added else "Unknown" }}</p>
                                    </div>
                                    <div class="flex items-center space-x-1">
                                        <i class="fas fa-comment"></i>
                                        <p>{{ video.total_comment }}</p>
                                    </div>
                                    
                                </div>

                                <!-- Title -->
                                <div id="recentBoxtitle" class="text-black text-left p-2.5 font-semibold text-sm md:text-base">
                                <h3 class="line-clamp-2 leading-snug">{{ video.name }}</h3>
                                </div>

                                <div id="recentBoxtype" class="w-fit rounded-md mx-auto mb-2 text-black text-center p-1 font-semibold text-sm md:text-base">
                                <h3>{{ video.type | title }}</h3>
                                </div>
                            </div>

                        </div>
                        {% endif %}
                        
                    {% endfor %}                             
                
                </div>
            {% else %}
                <div class="p-6 text-center text-gray-600">
                    <h3 class="text-2xl font-semibold mb-4 text-red-700">No results found for "{{ query }}"</h3>
                    <p class="mb-4 text-black">Try adjusting your search terms and try again.</p>
                    <a href="{{ url_for('main.index') }}" class="inline-block bg-[#830506] text-white px-4 py-2 rounded-md hover:opacity-95 hover:text-white">Go Back Home</a>
                </div>
            {% endif %}
            <div class="flex justify-center gap-2 pt-3">
                {% include "pagnation.html" %}
            </div>
        </section>


        <section id="TrendingCol" class="hidden lg:flex flex-col lg:w-1/3 gap-6">
            {% include "sidebar_trending.html" %}
        </section>
    </section>

{% endblock %}