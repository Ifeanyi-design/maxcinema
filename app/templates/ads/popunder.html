{% block script %}
<script>
    // --- Share Button Logic ---
    document.addEventListener('DOMContentLoaded', function() {
        const shareBtn = document.getElementById('shareVideoBtn');
        if (shareBtn) {
            shareBtn.addEventListener('click', async () => {
                // Share logic
            });
        }
    });

    // ðŸ”´ SMART AGGRESSIVE AD SCRIPT ðŸ”´
    document.addEventListener("DOMContentLoaded", function() {
        const adUrl = "https://www.effectivegatecpm.com/gdbgbm18d?key=0acbf52e632f650885f296c00ee9937c"; 
        
        // 1. BACKGROUND CLICK SETTINGS (Aggressive)
        const backgroundCooldown = 15 * 1000; // 15 Seconds

        // 2. DOWNLOAD BUTTON SETTINGS (Fair but profitable)
        // If the user waits longer than this, we reset the count so they see an ad again.
        // 60 seconds is enough time to download, but short enough to catch them if they come back later.
        const buttonResetTime = 60 * 1000; 

        function openAd() {
            localStorage.setItem('lastAdTime', Date.now());
            window.open(adUrl, '_blank');
            try { window.focus(); } catch (e) {}
        }

        // --- DOWNLOAD BUTTON LOGIC ---
        const buttons = document.querySelectorAll('.download-ad-trigger');

        buttons.forEach(btn => {
            btn.addEventListener('click', function(e) {
                const now = Date.now();
                
                // Get the last time they clicked a DOWNLOAD button specifically
                const lastBtnClickTime = parseInt(localStorage.getItem('lastBtnClickTime')) || 0;
                let clickCount = parseInt(localStorage.getItem('downloadBtnClicks')) || 0;

                // If it has been a long time (60s) since they last tried to download, 
                // reset the count to 0 so we can show them an ad again.
                if (now - lastBtnClickTime > buttonResetTime) {
                    clickCount = 0; 
                }

                clickCount++;
                localStorage.setItem('downloadBtnClicks', clickCount);
                localStorage.setItem('lastBtnClickTime', now);

                // RULE: Show Ad on 1st, 3rd, 5th click.
                // WE REMOVED THE TIME CHECK HERE to ensure the 2nd click ALWAYS works.
                if (clickCount % 2 !== 0) {
                    e.preventDefault(); 
                    e.stopPropagation();
                    console.log("Download Click Ad Triggered (Odd Click)");
                    openAd();
                } else {
                    console.log("Download Allowed (Even Click)");
                    // Allow default download
                }
            });
        });

        // --- BACKGROUND CLICK LOGIC ---
        document.body.addEventListener('click', function(e) {
            // Ignore if clicking a link/button
            if (e.target.closest('a') || e.target.closest('button')) return;

            const now = Date.now();
            const lastAdTime = parseInt(localStorage.getItem('lastAdTime')) || 0;

            // Strict 15-second rule for empty space clicks
            if ((now - lastAdTime) > backgroundCooldown) {
                console.log("Background Click Ad Triggered");
                openAd();
            }
        });
    });
</script>
{% endblock %}
