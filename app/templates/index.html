{% extends "base.html" %}

{% block content %}

<section id="Featured" class="mx-auto my-8 px-0 lg:px-4 max-w-[1600px] overflow-hidden">
    
    <div class="mx-2 lg:mx-0 bg-[#830506] flex justify-between items-center px-6 py-4 rounded-t-2xl shadow-lg relative overflow-hidden">
        <div class="absolute top-0 right-0 p-4 opacity-10">
            <i class="fa-solid fa-film text-6xl text-white transform -rotate-12 translate-x-4 -translate-y-4"></i>
        </div>
        
        <h2 class="font-black text-white text-lg md:text-2xl flex items-center gap-3 italic uppercase tracking-tighter relative z-10">
            <i class="fa-solid fa-fire-flame-curved text-yellow-400"></i> Featured Hits
        </h2>
        
        <a href="{{ url_for('main.featured') }}" class="relative z-10 group bg-white/10 hover:bg-white text-white hover:text-[#830506] font-bold text-[10px] md:text-xs border border-white/20 rounded-full px-4 py-2 transition-all uppercase tracking-wider">
            View All <i class="fa-solid fa-arrow-right ml-1 group-hover:translate-x-1 transition-transform"></i>
        </a>
    </div>

    <div class="relative group/section mx-2 lg:mx-0 bg-white p-4 rounded-b-2xl border-x border-b border-gray-100 shadow-sm">
        
        <button id="ScrollLeft" onclick="document.getElementById('featurecontain').scrollBy({left: -300, behavior: 'smooth'})" 
                class="absolute left-4 top-1/2 -translate-y-1/2 z-30 bg-white shadow-[0_5px_20px_rgba(0,0,0,0.15)] rounded-full w-12 h-12 hidden md:flex items-center justify-center hover:bg-[#830506] hover:text-white text-gray-700 transition-all opacity-0 group-hover/section:opacity-100 border border-gray-100 hover:scale-110 cursor-pointer">
            <i class="fa-solid fa-chevron-left"></i>
        </button>
        <button id="ScrollRight" onclick="document.getElementById('featurecontain').scrollBy({left: 300, behavior: 'smooth'})" 
                class="absolute right-4 top-1/2 -translate-y-1/2 z-30 bg-white shadow-[0_5px_20px_rgba(0,0,0,0.15)] rounded-full w-12 h-12 hidden md:flex items-center justify-center hover:bg-[#830506] hover:text-white text-gray-700 transition-all opacity-0 group-hover/section:opacity-100 border border-gray-100 hover:scale-110 cursor-pointer">
            <i class="fa-solid fa-chevron-right"></i>
        </button>

        <div id="featurecontain" class="flex overflow-x-auto gap-4 md:gap-6 w-full scroll-smooth snap-x scrollbar-hide pb-2">
            {% for featured in features %}
                <a href="{{url_for('main.detail', det=featured.type, name=featured.name, id=featured.id)}}" 
                   class="download-ad-trigger relative group flex flex-col flex-none w-[150px] md:w-[200px] snap-start overflow-hidden bg-white rounded-xl hover:-translate-y-1 transition-transform duration-300">
                    
                    <div class="absolute top-2 left-2 z-40 bg-white/90 backdrop-blur-md text-gray-900 border border-gray-200 rounded-lg px-2 py-1 flex items-center gap-1 shadow-sm">
                        <i class="fas fa-star text-yellow-500 text-[10px]"></i>
                        <span class="text-[10px] font-black">{{ featured.rating | round(1) }}</span>
                    </div>

                    <div class="relative w-full aspect-[2/3] rounded-xl overflow-hidden shadow-sm border border-gray-100">
                        <img src="{{ featured.image }}" 
                             alt="{{ featured.name }}" 
                             class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                             loading="lazy">
                        
                        <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity duration-300">
                             <div class="bg-[#830506] h-10 w-10 rounded-full flex items-center justify-center shadow-lg transform scale-0 group-hover:scale-100 transition-transform duration-300 border-2 border-white">
                                <i class="fa-solid fa-play text-white ml-0.5 text-sm"></i>
                             </div>
                        </div>
                    </div>

                    <div class="pt-3 px-1 flex flex-col flex-grow">
                        <h3 class="text-sm font-bold text-gray-900 line-clamp-1 group-hover:text-[#830506] transition-colors">
                            {{ featured.name }}
                        </h3>
                        <div class="flex justify-between items-center text-[10px] text-gray-400 mt-1 font-bold uppercase tracking-wider">
                            <span>{{ featured.date_added.strftime('%Y') }}</span>
                            <span class="flex items-center gap-1"><i class="fas fa-comment text-[8px]"></i> {{ featured.total_comment }}</span>
                        </div>
                    </div>
                </a>
            {% endfor %}
        </div>
    </div>
</section>


<section id="Merger" class="flex flex-col lg:flex-row gap-8 mx-auto px-2 lg:px-4 max-w-[1600px] my-4 md:my-8">
    
    <section id="RecentlyAdded" class="flex flex-col lg:w-3/4 mx-auto w-full">
        
        <div class="w-full bg-[#830506] flex items-center justify-center px-4 py-4 rounded-t-2xl shadow-md">
            <h2 class="font-black text-white text-lg md:text-xl flex items-center gap-2 italic uppercase tracking-tight">
                <i class="fa-solid fa-bolt text-yellow-400"></i> Recently Added
            </h2>
        </div>

        <div class="md:hidden w-full border-x border-b border-gray-100 bg-gray-50 p-2 flex items-center justify-center gap-2 shadow-inner">
            {% for nav_item in ['MOVIES', 'SERIES', 'TRAILERS', 'TRENDING'] %}
                <a href="{{ url_for('main.navbar', nav='all_' ~ nav_item|lower if nav_item != 'TRENDING' else 'trending') }}" 
                   class="flex-1 text-center text-[10px] font-black bg-white border border-gray-200 text-gray-500 py-2 rounded-lg hover:bg-[#830506] hover:text-white hover:border-[#830506] transition-all shadow-sm uppercase tracking-wide">
                   {{ nav_item }}
                </a>
            {% endfor %}
        </div>

        <div id="RecentlyAddedbox" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6 py-6 bg-white px-3 md:px-6 border-x border-b border-gray-100 rounded-b-2xl shadow-sm">
            {% for item in items %}
                {% set is_movie = item.__class__.__name__ == 'Movie' %}
                {% set video = item.all_video if is_movie else item.season.series.all_video %}
                
                <a class="group download-ad-trigger relative flex flex-col bg-white rounded-xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 cursor-pointer"
                     href="{{ url_for('main.detail', det=video.type, name=video.name, id=video.id, season=item.season.season_number if not is_movie else none, episode=item.episode_number if not is_movie else none) }}">
                    
                    <div class="absolute top-2 left-2 z-40 bg-white/90 backdrop-blur-sm px-2 py-0.5 rounded-md flex items-center gap-1 shadow-sm border border-gray-200">
                        <i class="fas fa-star text-yellow-500 text-[9px]"></i>
                        <span class="text-[10px] font-black text-gray-900">{{ video.rating | round(1) }}</span>
                    </div>

                    <div class="relative w-full aspect-[2/3] overflow-hidden bg-gray-100">
                        <img src="{{ video.image }}" alt="{{ video.name }}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" loading="lazy">
                        
                        {% if not is_movie %}
                            <div class="absolute bottom-2 right-2 z-30 flex flex-col gap-1 items-end">
                                {% if item.season.completed %}
                                    <span class="bg-green-600 text-white text-[8px] font-black px-1.5 py-0.5 rounded shadow-md uppercase tracking-wide">Completed</span>
                                {% endif %}
                                <span class="bg-[#830506] text-white text-[9px] font-black px-2 py-0.5 rounded shadow-md uppercase">S{{ item.season.season_number }} E{{ item.episode_number }}</span>
                            </div>
                        {% endif %}

                        <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity duration-300">
                            <i class="fa-solid fa-circle-play text-white text-5xl drop-shadow-lg transform scale-90 group-hover:scale-100 transition-transform"></i>
                        </div>
                    </div>

                    <div class="p-3 flex flex-col flex-grow">
    
                        <h3 class="text-sm font-bold text-gray-900 line-clamp-2 group-hover:text-[#830506] transition-colors leading-5 h-10 overflow-hidden mb-2">
                            {{ video.name }}
                        </h3>

                        <div class="flex justify-between items-center text-[10px] font-bold text-gray-400 uppercase border-t pt-2 border-gray-50 mt-auto">
                            <span class="flex items-center gap-1">
                                <i class="fas fa-calendar-alt text-[#830506]"></i>
                                {{ video.date_added.strftime('%Y') }}
                            </span>
                            <span class="bg-gray-100 text-gray-600 px-2 py-0.5 rounded text-[9px] tracking-wide">
                                {{ video.type }}
                            </span>
                            <span class="flex items-center gap-1">
                                <i class="fas fa-comment text-[#830506]"></i>
                                {{ video.total_comment }}
                            </span>
                        </div>
                    </div>
                </a>
            {% endfor %}
        </div>

        <div class="flex justify-center py-8 gap-2">
            {% include 'pagnation.html' %}
        </div>
    </section>

    <aside id="TrendingCol" class="flex flex-col lg:w-1/4 gap-8">
        
        <div class="sticky top-24 space-y-6">
            
            <div class="w-full flex flex-col gap-4">
                <div class="rounded-xl overflow-hidden shadow-sm border border-gray-100">
                    {% include 'ads/sidebar.html' %}
                </div>
            </div>

            {% set categories = [
                {'id': 'TrendingMovies', 'title': 'Trending Movies', 'icon': 'fa-fire', 'data': trending_movie, 'type': 'movie'},
                {'id': 'TrendingSeries', 'title': 'Trending Series', 'icon': 'fa-fire', 'data': trending_series, 'type': 'series'},
                {'id': 'Trailers', 'title': 'New Trailers', 'icon': 'fa-play-circle', 'data': trending_trailers, 'type': 'trailer'}
            ] %}

            {% for cat in categories %}
                <section id="{{ cat.id }}" class="flex flex-col w-full bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="w-full bg-[#830506] flex items-center justify-between px-4 py-3">
                        <h2 class="font-black text-white text-xs uppercase flex items-center gap-2 tracking-wide">
                            <i class="fa-solid {{ cat.icon }}"></i> {{ cat.title }}
                        </h2>
                    </div>

                    <div class="flex flex-col">
                        {% for item in cat.data %}
                        <div onclick="window.location.href='{% if cat.type == 'trailer' %}{{ url_for('main.detail', det='trailer_watch', name=item.slug, id=item.id) }}{% else %}{{ url_for('main.detail', det=item.type, name=item.name, id=item.id, season='1', episode='1') }}{% endif %}'" 
                            class="group flex items-center gap-3 p-2 hover:bg-gray-50 transition-colors cursor-pointer border-b border-gray-50 last:border-0">
                            
                            <div class="flex-shrink-0 w-16 h-12 rounded overflow-hidden relative">
                                <img src="{{ item.image }}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                            </div>

                            <div class="flex flex-col justify-center overflow-hidden">
                                <h3 class="text-gray-900 text-[11px] font-bold line-clamp-1 group-hover:text-[#830506] transition-colors leading-tight">
                                    {{ item.name }}
                                </h3>
                                <div class="flex items-center gap-2 mt-1 text-[9px] text-gray-400 font-bold uppercase">
                                    <span>{{ (item.updated_at or item.date_added).strftime('%b %d, %Y') }}</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <div class="p-2 bg-gray-50 border-t border-gray-100 text-center">
                        <a href="{% if cat.type == 'trailer' %}{{ url_for('main.trailer') }}{% else %}{{ url_for('main.trending', type=cat.type) }}{% endif %}" 
                        class="text-[10px] font-black text-[#830506] hover:underline uppercase tracking-widest">
                            View All <i class="fa-solid fa-arrow-right ml-1"></i>
                        </a>
                    </div>
                </section>
            {% endfor %}
        </div>
    </aside>
</section>

{% endblock %}